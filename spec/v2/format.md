# Формат записи логов

## Вариант универсального внешнего логера (не наш случай)

При инициализации логера передаётся следующая информация (liblogwriter пишет в стандартный вывод при инициализации):
* признак инициирующего сообщения - нуль
* последовательность байтов (завершающаяся байтом 0x00), задающая количетсов тэгов и их размерности.

Каждое сообщение лога (то, что liblogwriter должен выводить на стандартный вывод) имеет следующий формат:
* размер сообщения всего в байтах (4 байта)
* время (`time_t`, 8 байтов, число секунд, прошедшее от Эпохи). Если нуль, значит время берёт сам логер системное.
* последовательность тегов. В зависимости от инициализирующего логер сообщения это разное количество байтов. Каждый тег представляется 32-битным беззнаковым целым числом.
* пары (размер сообщения в байтах(4 байта))-(тело сообщения).

Здесь идёт выравнивание по слову 4 байта, что характерно для 64-битных процессоров.

## Вариант логера, собранного под конкретный комплекс (как раз наш случай)

Логер уже знает количество тегов.

Каждое сообщение лога (то, что liblogwriter должен выводить на стандартный вывод) имеет следующий формат:
* (время) (`time_t`, 8 байтов, число секунд, прошедшее от Эпохи). Это поле присутствует только в том случае, если определена переменная окружения `TMHSMART_LOGGER_TEST`.
* последовательность тегов. Каждый тег представлен 32-битным беззнаковым числом.
* идентификатор сообщения (32-битное беззнаковое число)
* в зависимости от сообщения, аргументы (а их может и не быть!)

# Структура файла лога (как его должен вести логгер)

* время ранней записи
* время последней записи
* логи. Каждый лог состоит из следующих полей:
	* время (`time_t`, 8 байтов, число секунд, прошедшее от Эпохи)
	* адрес следующего лога (сообщения в файле), 32-битное беззнаковое целое
	* последовательность тегов, 32 * N, где N - константа, определяемая на этапе сборки логера
	* идентификатор сообщения, 32-битное беззнаковое целое
	* аргументы сообщения, разной длины в зависимости от идентификатора сообщения (может быть и вариативного размера)

Поле "адрес следующего лога" выставляется в нуль перед записью лога. По окончании записи лога выставляется в актуальное значение. Это защита от физического прерывания записи.

## Структура директории с файлами логов

В директории с логами располагаются следующие файлы:
* 1,2,3, ... , 11, 12, 13, ...., 101, 102, ... - в соответствии с настройками логера
* index - здесь хранится имя файла, в который был записан последний лог
